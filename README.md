# RadOnco — веб-панель и Telegram-бот для лучевой терапии

Веб-система для ведения амбулаторных карт пациентов ЛТ и быстрого доступа к данным через Telegram-бота.

---

## 1. Требования

- **Node.js** ≥ 18
- **npm** (идёт вместе с Node.js)
- ОС: Windows / Linux / macOS

Проверить версии:

```bash
node -v
npm -v
```

---

## 2. Установка зависимостей

Из корня проекта:

```bash
npm install
```

---

## 3. Настройка `.env`

В корне проекта создайте файл **`.env`** (или отредактируйте существующий).

Пример:

```env
# HTTP
PORT=3000
SESSION_SECRET=super-secret-string

# SQLite (файл базы)
DB_FILE=radonco.db

# Админ по умолчанию
ADMIN_LOGIN=admin
ADMIN_PASSWORD=admin

# Telegram-бот (опционально, можно временно не задавать)
BOT_TOKEN=1234567890:AA...your_token_here
```

Если `BOT_TOKEN` не задан, запустится только веб-панель (бот будет отключён).

---

## 4. Запуск приложения

Из корня проекта:

```bash
npm start
```

В консоли должно появиться примерно:

```text
[HTTP] RadOnco веб-панель запущена на порту 3000
[db] Админ-пользователь "admin" готов. Можно входить с этим паролем.
[Bot] Запущен, токен: 123***:***   # если задан BOT_TOKEN
```

Открыть в браузере:

```text
http://localhost:3000
```

---

## 5. Первый вход

- Логин: `admin`
- Пароль: `admin`  
(если вы не поменяли `ADMIN_LOGIN` и `ADMIN_PASSWORD` в `.env`)

После входа можно:

- Зайти в **админ-панель пользователей**: `http://localhost:3000/admin/users`
- Создать/отредактировать врачей, указать им **Telegram ID** (для уведомлений и работы бота)
- Создавать и редактировать **карты пациентов** в разделе `/patients`

---

## 6. Telegram-бот (если указан BOT_TOKEN)

1. В `@BotFather` создать бота и получить токен.
2. Вписать токен в `.env` переменную `BOT_TOKEN`.
3. Перезапустить сервер:  
   ```bash
   npm start
   ```
4. В админ-панели в карточке пользователя заполнить поле `Telegram ID`  
   (можно взять из `/start` в самом боте).
5. После этого:
   - бот присылает уведомления об изменениях карт;
   - по ID пациента врач может запросить краткую карточку (поля 8–12).

---

## 7. Полезные команды

```bash
# установка зависимостей
npm install

# запуск в обычном режиме
npm start

# (опционально) проверка пакетов на уязвимости
npm audit
```

Если нужно пересоздать базу при разработке — остановите сервер, удалите файл `radonco.db` и снова запустите `npm start` (таблицы создадутся заново).
